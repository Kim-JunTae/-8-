# Chapter13 함수형 관점으로 생각하기

### 이 장의 내용

- 왜 함수형 프로그래밍을 사용하는가?
- 함수형 프로그래밍은 어떻게 정의하는가?
- 선언형 프로그래밍과 참조 투명성
- 함수형 스타일의 자바 구현 가이드라인
- 반복과 재귀

- 개요

    ### 함수형 Functional

    - 람다
    - 일급 함수
    - 객체 변화를 제한하는 것

    ### 함수형을 적용하면 좋은 점에 대한 답을 찾는 장

    ### 순서

    - 함수형 프로그래밍은 무엇인지
    - 관련 용어
    - 함수형 프로그래밍의 개념(부작용, 불변성, 선언형 프로그래밍, 참조 투명성, 자바8에서 제공하는 기능)
    - 14장에서는 함수형 프로그래밍 기법
    고차원 함수, 커링, 영속 데이터 구조체, 게으른 리스트, 패턴 패칭, 콤비네이터 등

- 왜 함수형 프로그래밍인가?

    ### 시스템 구현과 유지보수

    - 구현되어 있느나 실제 경험해본 적 없는 대규모 소프트웨어 시스템 업그레이드 관리를 요청했다고 가정하자
        - **synchronized**라는 키워드가 발견된다면 제안을 거절하라
            - 동시성 버그를 고치는 일은 정말 어렵다.
            - 자바 8의 스트림을 이용하면 잠금(locking) 문제를 신경쓰지 않을 수 있었다.
            단 상태가 없는 동작이어야 한다는 조건을 만족해야 한다.
    - 함수형 프로그래밍이 제공하는 부작용 없음(no side effect)과 불변성(immutability)이라는 개념이 핵심!
    - synchronized

        자바 코드에서 동기화 영역은 synchronizred 키워드로 표시된다. 
        동기화는 객체에 대한 동기화로 이루어지는데(synchronized on some object), 
        같은 객체에 대한 모든 동기화 블록은 **한 시점에 오직 한 쓰레드만이 블록 안으로 접근**하도록 실행하도록 한다. 
        블록에 접근을 시도하는 다른 쓰레드들은 블록 안의 쓰레드가 실행을 마치고 블록을 벗어날 때까지 블록(blocked) 상태가 된다.

    - side effect

        함수 호출 : 인풋에 따른 결과값을 얻어내기 위함

        함수가 함수 외부의 어떤 것을 변경하게 된다면 의도치 않은 동작을 한 것

        이런 현상을 함수형 프로그래밍에서는 사이드 이펙트라고 한다.
        (디버깅 힘듬. 각 함수 내부를 뒤져서 이게 어디에 영향을 주는지 일일히 파악해야함)

    - immutability

    ### 공유된 가변 데이터

    - 공유 가변 데이터 구조를 사용하면
    프로그램 전체에서 데이터 갱신 사실을 추적하기가 어려워진다.

    ![Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled.png](Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled.png)

    - 어떤 자료구조도 바꾸지 않는 시스템
    자신을 포함하는 클래스의 상태 그리고 다른 객체의 상태를 바꾸지 않으며 return문을 통해서만 자신의 결과를 반환하는 메서드를 순수 메서드 또는 부작용 없는 메서드라고 부른다.
    - 부작용은 무엇일까? 함수 내에 포함되지 못한 기능을 부작용이라고 한다
        - 자료구조를 고치거나 필드에 값을 할당(setter 메서드와 같은 생성자 이외의 초기화 동작)
        - 예외 발생
        - 파일에 쓰기 등의 I/O 동작 수행
    - 불변 객체를 이용해서 없애는 방법도 있다.
        - 인스턴스화한 다음 객체의 상태를 바꿀 수 없는 객체이므로 함수 동작에 영향을 받지 않는다.
        - 복사하지 않고 공유할 수 있으며, 스레드 안정성을 제공한다.

    우선 함수형 프로그래밍의 기반을 이루는 개념인 선언형 프로그래밍을 살펴보자

    ### 선언형 프로그래밍 declarative programming

    프로그램으로 시스템을 구현하는 방식은 크게 두 가지로 구분

    1. 순서, 일련의 명령, "어떻게 how"에 집중하는 프로그래밍 형식
    명령형 프로그래밍, 고전의 객체지향 프로그래밍에서 이용하는 방식
    2. "무엇을 what"에 집중하는 방식
    내부 반복(internal iteration), 질의문 자체로 문제를 어떻게 푸는지 명확하게 보여준다는 것이 내부 반복 프로그래밍의 큰 장점이다.

    ### 왜 함수형 프로그래밍인가?

    함수형 프로그래밍은 선언형 프로그래밍을 따르는 대표적인 방식이며, 부작용이 없는 계산을 지향한다.

- 함수형 프로그래밍이란 무엇인가?

    ![Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled%201.png](Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled%201.png)

    ![Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled%202.png](Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled%202.png)

    ### 함수형 자바

    실질적으로 자바로는 완벽한 순수 함수형 프로그래밍을 구현하기 어렵다.
    I/O 모델 자체에는 부작용 메서드가 포함된다(Scanner.nextLine은 파일의 행을 소비한다)

    하지만 시스템의 컴포넌트가 순수한 함수형인 것처럼 동작하도록 코드를 구현할 수 있다.
    함수형 프로그램을 구현할 것이다.
    실제 부작용이 있지만 아무도 이를 보지 못하게 함으로써 함수형을 달성할 수 있다.

    함수나 메서드는 지역 변수만을 변경해야 함수형이라고 할 수 있다. 
    참조하는 객체가 있다면 그 객체는 불변 객체여야 한다.

    함수나 메서드가 어떤 예외도 일으키지 않아야한다. 
    이러한 제약은 함수를 수학적으로 활용하는 데 큰 걸림돌이 될 것이다.
    수학적 함수는 주어진 인수값에 대응하는 하나의 결과를 반환한다. 
    실제 대부분의 수학 연산은 부분 함수로 활용된다. 
    어떤 입력값이 있다면 정확하게 하나의 결과로 도출되지만 
    입력값이 undefined라면 결과가 아예 나오지 않는다.
    (0으로 어떤 수를 나눈다든가 sqrt의 인수가 음수인 상황 등)

    ![Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled%203.png](Chapter13%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%89%E1%85%AE%E1%84%92%E1%85%A7%E1%86%BC%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B7%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%80%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20ea4b7c916bac43eeb86d766dca5244d9/Untitled%203.png)

    Optional<T>를 사용하여 해결할 수 있다.

    - 마커 어노테이션?
        - 마커 어노테이션 (Maker Annotation)
            - @NewAnnotation
        - 싱글 값 어노테이션 (Single Value Annotation)
            - @NewAnnotation(id=10)
        - 멀티 값 어노테이션 (Multi Value Annotation)
            - @NewAnnotation(id=10, name=“hello”, roles= {“admin”, “user"})

        참고 : 
        [https://advenoh.tistory.com/21](https://advenoh.tistory.com/21)
        [https://velog.io/@kwj1270/어노테이션](https://velog.io/@kwj1270/%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98)

- 참조 투명성

### 요약

- 공유된 가변 자료구조를 줄이는 것은 장기적으로 프로그램을 유지보수하고 디버깅하는데 도움이 된다.
- 함수형 프로그래밍은 부작용이 없는 메서드와 선언형 프로그래밍 방식을 지향한다.
- 함수형 메서드는 입력인수와 출력결과만을 갖는다.
- 같은 인수값으로 함수를 호출했을 때 항상 같은 값을 봔한하면 참조 투명성을 갖는 함수이다.
while 루프 같은 반복문은 재귀로 대체할 수 있다.
- 자바에서는 고전 방식의 재귀보다는 꼬리 재귀를 사용해야 추가적인 컴파일러 최적화를 기대할 수 있다.